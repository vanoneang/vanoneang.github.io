(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{542:function(t,a,s){"use strict";s.r(a);var e=s(10),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"vue源码理解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue源码理解"}},[t._v("#")]),t._v(" Vue源码理解")]),t._v(" "),a("h2",{attrs:{id:"mvvm的三要素"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mvvm的三要素"}},[t._v("#")]),t._v(" MVVM的三要素")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("响应式：vue如何监听到"),a("code",[t._v("data")]),t._v("的每个"),a("code",[t._v("属性变化")]),t._v("？")])]),t._v(" "),a("li",[a("p",[t._v("模板引擎：vue的"),a("code",[t._v("模板")]),t._v("如何被"),a("code",[t._v("解析")]),t._v("，指令如何处理？")])]),t._v(" "),a("li",[a("p",[t._v("渲染：vue的"),a("code",[t._v("模板")]),t._v("如何被"),a("code",[t._v("渲染")]),t._v("成"),a("code",[t._v("html")]),t._v("？以及渲染过程")])])]),t._v(" "),a("h2",{attrs:{id:"vue中如何实现响应式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue中如何实现响应式"}},[t._v("#")]),t._v(" vue中如何实现响应式？")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("什么是响应式")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("修改"),a("code",[t._v("data")]),t._v("属性后，vue立刻监听到")])]),t._v(" "),a("li",[a("p",[t._v("data属性被代理到vm上")])])])]),t._v(" "),a("li",[a("p",[t._v("Object.defineProperty")])])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" obj "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" _name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'evan'")]),t._v("\n\nObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineProperty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'get'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" _name\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("newVal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'set'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newVal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    _name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newVal\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可以监听到")]),t._v("\nobj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wang'")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可以监听到")]),t._v("\n")])])]),a("blockquote",[a("p",[t._v("所以，vue中数据改变，视图就改变，其核心就是通过"),a("code",[t._v("Object.defineProperty")]),t._v("实时监听到数据的变化")])]),t._v(" "),a("ul",[a("li",[t._v("模拟")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" vm "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'evan'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("age")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("value\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineProperty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'get'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("newVal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'set'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newVal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听")]),t._v("\n        data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newVal\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"object-defineproperty-api-缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#object-defineproperty-api-缺点"}},[t._v("#")]),t._v(" Object.defineProperty API 缺点")]),t._v(" "),a("ul",[a("li",[t._v("不能监听对象属性新增和删除")]),t._v(" "),a("li",[t._v("初始化阶段递归执行 "),a("code",[t._v("Object.defineProperty")]),t._v(" 带来的性能负担")])]),t._v(" "),a("h3",{attrs:{id:"reactive-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reactive-api"}},[t._v("#")]),t._v(" Reactive API")]),t._v(" "),a("ul",[a("li",[t._v("响应式的实现方式就是 "),a("code",[t._v("劫持数据")]),t._v("，Vue.js 3.0 的 Reactive API 就是通过 "),a("code",[t._v("Proxy")]),t._v(" 劫持数据，由于 Proxy 劫持的是整个对象，所以可以检测到任何对对象的修改，弥补了 "),a("code",[t._v("Object.defineProperty API")]),t._v(" 的不足。")])]),t._v(" "),a("h2",{attrs:{id:"vue中如何解析模板"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue中如何解析模板"}},[t._v("#")]),t._v(" vue中如何解析模板")]),t._v(" "),a("ul",[a("li",[t._v("模板是什么？")])]),t._v(" "),a("ol",[a("li",[a("p",[t._v("本质：字符串")])]),t._v(" "),a("li",[a("p",[t._v("有逻辑，如"),a("code",[t._v("v-if``v-for")]),t._v("等")])]),t._v(" "),a("li",[a("p",[t._v("与"),a("code",[t._v("html")]),t._v("格式很像，但有很大区别")])]),t._v(" "),a("li",[a("p",[t._v("最终还是要转换为"),a("code",[t._v("html")]),t._v("来显示")])]),t._v(" "),a("li",[a("p",[t._v("模板最终必须转成JS代码，因为：")]),t._v(" "),a("p",[t._v("a. 有逻辑（v-if v-for），必须用JS才能实现（图灵完备）")]),t._v(" "),a("p",[t._v("b. 转换为html渲染页面，必须用JS才能实现")]),t._v(" "),a("p",[t._v("c. 因此，模板最重要转换成一个JS函数（"),a("code",[t._v("render函数")]),t._v("）")])])]),t._v(" "),a("ul",[a("li",[t._v("render函数")])]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("{{price}}"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_c")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'div'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("attrs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"app"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_c")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'p'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_v")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_s")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("price"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ol",[a("li",[a("p",[t._v("模板中所有信息都包含在了"),a("code",[t._v("render")]),t._v("函数中")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("this")]),t._v("即"),a("code",[t._v("vm")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("price")]),t._v("即"),a("code",[t._v("this.price")]),t._v("即"),a("code",[t._v("vm.price")]),t._v("，即"),a("code",[t._v("data")]),t._v("中的"),a("code",[t._v("price")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("_c")]),t._v("即"),a("code",[t._v("this._c")]),t._v("即"),a("code",[t._v("vm._c")])])])]),t._v(" "),a("img",{attrs:{src:t.$withBase("/assets/render.png")}}),t._v(" "),a("ul",[a("li",[t._v("render函数执行时返回vnode")])]),t._v(" "),a("p",[t._v("a. "),a("code",[t._v("updateComponent")]),t._v("t中实现了"),a("code",[t._v("vdom")]),t._v("的"),a("code",[t._v("path")])]),t._v(" "),a("p",[t._v("b. 页面首次渲染执行"),a("code",[t._v("updateComponent")])]),t._v(" "),a("p",[t._v("c. data中每次修改属性，执行"),a("code",[t._v("updateComponent")])]),t._v(" "),a("h2",{attrs:{id:"vue的整个实现流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue的整个实现流程"}},[t._v("#")]),t._v(" vue的整个实现流程")]),t._v(" "),a("ol",[a("li",[a("p",[a("strong",[t._v("解析模板成"),a("code",[t._v("render")]),t._v("函数")])]),t._v(" "),a("p",[t._v("a.  模板中所有信息都被"),a("code",[t._v("render")]),t._v("函数所包含")]),t._v(" "),a("p",[t._v("b. 模板中用到的"),a("code",[t._v("data")]),t._v("中的属性，都变成了JS变量")]),t._v(" "),a("p",[t._v("c. 模板中的"),a("code",[t._v("v-model v-for")]),t._v("都变成了JS逻辑")]),t._v(" "),a("p",[t._v("d. "),a("code",[t._v("render")]),t._v("函数返回"),a("code",[t._v("vnode")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("响应式开始监听")])]),t._v(" "),a("p",[t._v("a. vue中数据驱动视图改变，其核心就是通过"),a("code",[t._v("Object.defineProperty")]),t._v("实时监听到数据的变化")]),t._v(" "),a("p",[t._v("b. 同样，通过"),a("code",[t._v("Object.defineProperty")]),t._v("，将"),a("code",[t._v("data")]),t._v("的属性代理到"),a("code",[t._v("vm")]),t._v("上")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("首次渲染，显示页面，且绑定依赖")])]),t._v(" "),a("p",[t._v("a. 初次渲染，执行"),a("code",[t._v("updateComponent")]),t._v(",执行"),a("code",[t._v("vm._render()")])]),t._v(" "),a("p",[t._v("b. 执行"),a("code",[t._v("render")]),t._v("函数，会访问到上一步代理到"),a("code",[t._v("vm")]),t._v("上的"),a("code",[t._v("data")]),t._v("的属性")]),t._v(" "),a("p",[t._v("c. 会被响应式的"),a("code",[t._v("get")]),t._v("方法监听到")]),t._v(" "),a("p",[a("em",[t._v("因为，data中有很多属性，有些被用到，有些可能不被用到，被用到的走get，不被用到的不会走到get，未走到get中的属性，set的时候我们也无需关心，避免不必要的重复渲染")])]),t._v(" "),a("p",[t._v("d. 执行"),a("code",[t._v("updateComponent")]),t._v("，会走到"),a("code",[t._v("vdom")]),t._v("的"),a("code",[t._v("patch")]),t._v("方法")]),t._v(" "),a("p",[t._v("e. "),a("code",[t._v("patch")]),t._v("将"),a("code",[t._v("vnode")]),t._v("渲染成"),a("code",[t._v("DOM")]),t._v("，初次渲染完成")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("data属性变化，触发"),a("code",[t._v("rerender")])])]),t._v(" "),a("p",[t._v("a. 修改属性，被响应式的"),a("code",[t._v("set")]),t._v("监听到")]),t._v(" "),a("p",[t._v("b. "),a("code",[t._v("set")]),t._v("中执行"),a("code",[t._v("updateComponent")])]),t._v(" "),a("p",[t._v("c. "),a("code",[t._v("updateComponent")]),t._v("重新执行"),a("code",[t._v("vm._render()")])]),t._v(" "),a("p",[t._v("d. 生成的"),a("code",[t._v("vnode")]),t._v("和"),a("code",[t._v("preVnode")]),t._v("，通过"),a("code",[t._v("patch")]),t._v("进行对比")]),t._v(" "),a("p",[t._v("e. 渲染到"),a("code",[t._v("html")])])])]),t._v(" "),a("h2",{attrs:{id:"入口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#入口"}},[t._v("#")]),t._v(" 入口")]),t._v(" "),a("p",[t._v("vue首先是一个Function，es5中通过方法声明一个类，需要new这个方法，也就是new Vue()，生成一个实例对象，这个实例对象上有那么多方法哪来的呢？是通过Vue的prototype挂载到原型上。")]),t._v(" "),a("p",[t._v("这里没有通过ES6的class来定义，原因就是js是动态类型语言，通过方法，我们可以随意挂载方法到它的原型上，这样一类方法用一个文件来编写，就把代码解耦了，做到了模块化拆分。")]),t._v(" "),a("h2",{attrs:{id:"vue的数据驱动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue的数据驱动"}},[t._v("#")]),t._v(" vue的数据驱动")]),t._v(" "),a("p",[t._v("vue是怎么通过"),a("code",[t._v("data")]),t._v("的赋值就实现了DOM的渲染呢？并没有像jq那样直接操作dom啊？下面就是答案：")]),t._v(" "),a("p",[t._v("在Vue中，我们通过"),a("code",[t._v("$mount")]),t._v("实例方法来挂载"),a("code",[t._v("vm")]),t._v("。")]),t._v(" "),a("p",[t._v("首先，对"),a("code",[t._v("el")]),t._v("做了限制，Vue不能挂载到"),a("code",[t._v("body")]),t._v("、"),a("code",[t._v("html")]),t._v("上这样的根节点上，然后会进行判断，如果没有定义"),a("code",[t._v("render")]),t._v("方法，则会把"),a("code",[t._v("el")]),t._v("或者"),a("code",[t._v("template")]),t._v("字符串转换成"),a("code",[t._v("render")]),t._v("方法。")]),t._v(" "),a("p",[a("code",[t._v("$mount")]),t._v("方法传入两个参数，第一个是"),a("code",[t._v("el")]),t._v("，表示挂载的元素，可以是字符串，也可以是DOM对象，如果是字符串在浏览器环境下会调用"),a("code",[t._v("query")]),t._v("方法来转成DOM对象，第二个参数是和服务端渲染（ssr）有关。")]),t._v(" "),a("p",[t._v("然后就是调用"),a("code",[t._v("vm._render")]),t._v("方法了生成虚拟的Node了，同时呢，在实例化一个"),a("code",[t._v("Watcher")]),t._v("，也就是说在页面初始化的时候通过一大堆的数据计算后，渲染DOM，然后呢，中间数据变化了，"),a("code",[t._v("Watcher")]),t._v("监听到了，再次执行。")]),t._v(" "),a("p",[t._v("第一步，把一堆"),a("code",[t._v("template")]),t._v("转成"),a("code",[t._v("render")]),t._v("函数；")]),t._v(" "),a("p",[t._v("第二步，通过"),a("code",[t._v("render")]),t._v("中的"),a("code",[t._v("createElement")]),t._v("创建组件的"),a("code",[t._v("VNode")]),t._v("（虚拟DOM）")]),t._v(" "),a("p",[t._v("第三步，走"),a("code",[t._v("vm._update")]),t._v("调用"),a("code",[t._v("__patch__")]),t._v("，把虚拟DOM转换成真正的DOM节点。")]),t._v(" "),a("p",[a("code",[t._v("update")]),t._v("的调用时机有两个，一个是首次渲染，一个是数据更新的时候，通过"),a("code",[t._v("VNODE Tree")]),t._v("调用js原生的"),a("code",[t._v("appendChild")]),t._v("方法，调用"),a("code",[t._v("insert")]),t._v("方法把"),a("code",[t._v("DOM")]),t._v("插入到父节点，进行递归调用，把虚拟dom和真实dom映射到一起，从而实现DOM的真正渲染。")]),t._v(" "),a("p",[a("code",[t._v("vdom")]),t._v("的真正意义是为了实现跨平台，服务端渲染，以及提供一个性能还算不错 "),a("code",[t._v("Dom")]),t._v(" 更新策略\n"),a("code",[t._v("vdom")]),t._v(" 让整个 "),a("code",[t._v("mvvm")]),t._v(" 框架灵活了起来，性能不是最重要的\n好的 "),a("code",[t._v("diff")]),t._v(" 算法只是 "),a("code",[t._v("vdom")]),t._v(" 实现层面的优化，而并不代表 "),a("code",[t._v("vdom")]),t._v(" 本身是为了性能优化")]),t._v(" "),a("h2",{attrs:{id:"runtime-only和compiler-and-runtime"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#runtime-only和compiler-and-runtime"}},[t._v("#")]),t._v(" runtime-only和compiler and runtime")]),t._v(" "),a("p",[t._v("vue实例挂载，最终都要通过render函数来执行，如果采用"),a("code",[t._v("runtime-only")]),t._v("模式，要直接写render函数，而采用"),a("code",[t._v("compiler")]),t._v("组合的模式，则可以书写"),a("code",[t._v("template")]),t._v("。通过"),a("code",[t._v("wm._update")]),t._v("方法传入"),a("code",[t._v("render")]),t._v("来渲染"),a("code",[t._v("Watcher")]),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"component生成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#component生成"}},[t._v("#")]),t._v(" component生成")]),t._v(" "),a("p",[t._v("组件的生成的流程，是之前通过render方法，来"),a("code",[t._v("createElement")]),t._v("，如果tag是传入的最上层的"),a("code",[t._v("app")]),t._v("组件，那么首先Vue会构造子类的构造函数，把自身的一堆"),a("code",[t._v("options")]),t._v("传递给子类，组件集成过程其实用的就是")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Sub")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Sub")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("constructor "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Sub\n")])])]),a("p",[a("code",[t._v("Super")]),t._v("完全继承了"),a("code",[t._v("Vue")]),t._v("的各种属性，所以"),a("code",[t._v("Vue.extend")]),t._v("也可以用组件"),a("code",[t._v("componentName.extent")]),t._v("来表示。")]),t._v(" "),a("p",[t._v("这里面有一个缓存方法，把构造函数进行了缓存，对于拥有相同父类的子组件，就不重复构造了。完了之后，通过"),a("code",[t._v("new VNode")]),t._v("实例化一个"),a("code",[t._v("vnode")]),t._v("并返回。")]),t._v(" "),a("h2",{attrs:{id:"派发更新和nexttick"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#派发更新和nexttick"}},[t._v("#")]),t._v(" 派发更新和nextTick")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("派发更新")]),t._v("就是当数据发生改变后，通知所有订阅了这个数据变化的"),a("code",[t._v("watcher")]),t._v("执行"),a("code",[t._v("update")])])]),t._v(" "),a("li",[a("p",[t._v("派发更新的过程中会把所有要执行"),a("code",[t._v("update")]),t._v("的"),a("code",[t._v("watcher")]),t._v("推入队列中，在"),a("code",[t._v("nextTick")]),t._v("后执行"),a("code",[t._v("flush")]),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("把所有的数据变化都收集到一次，做一次"),a("code",[t._v("nextTick")])])]),t._v(" "),a("li",[a("p",[t._v("数据的变化到dom的变化是一个异步的过程")])]),t._v(" "),a("li",[a("p",[t._v("本次"),a("code",[t._v("nextTick")]),t._v("如果没有执行到，会被收集到"),a("code",[t._v("callbacks")]),t._v("数组中，下次"),a("code",[t._v("nextTick")]),t._v("执行")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("nextTick")]),t._v("返回一个"),a("code",[t._v("promise")]),t._v("对象")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("nextTick")]),t._v("是把要执行的任务推入到一个队列中，在下一个tick同步执行")])])]),t._v(" "),a("RightMenu")],1)}),[],!1,null,null,null);a.default=n.exports}}]);